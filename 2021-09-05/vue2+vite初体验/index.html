<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><title>vue2+vite初体验 | 磨蹭先生</title><meta name="description" content="自从 vite 发布之后，社区赞誉无数，而我也一直心水 vite 的轻量快速的热重载的特性，特别是公司的项目巨大，已经严重拖慢了热重载的速度了，每次热重载都要等上一小会，所以急需寻找一个解决方案。"><meta name="keywords" content="vite"><meta name="author" content="gating"><meta name="copyright" content="gating"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="vue2+vite初体验"><meta name="twitter:description" content="自从 vite 发布之后，社区赞誉无数，而我也一直心水 vite 的轻量快速的热重载的特性，特别是公司的项目巨大，已经严重拖慢了热重载的速度了，每次热重载都要等上一小会，所以急需寻找一个解决方案。"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="vue2+vite初体验"><meta property="og:url" content="https://gatings.cn/2021-09-05/vue2+vite%E5%88%9D%E4%BD%93%E9%AA%8C/"><meta property="og:site_name" content="磨蹭先生"><meta property="og:description" content="自从 vite 发布之后，社区赞誉无数，而我也一直心水 vite 的轻量快速的热重载的特性，特别是公司的项目巨大，已经严重拖慢了热重载的速度了，每次热重载都要等上一小会，所以急需寻找一个解决方案。"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode="1";var t=Cookies.get("theme");{const e=window.matchMedia("(prefers-color-scheme: dark)").matches,o=window.matchMedia("(prefers-color-scheme: light)").matches,a=window.matchMedia("(prefers-color-scheme: no-preference)").matches,c=!e&&!o&&!a;void 0===t?o?activateLightMode():e?activateDarkMode():(a||c)&&(console.log("You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time."),now=new Date,hour=now.getHours(),isNight=hour<6||hour>=18,isNight?activateDarkMode():activateLightMode()):"light"==t?activateLightMode():activateDarkMode()}function activateDarkMode(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#000")}function activateLightMode(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#fff")}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://gatings.cn/2021-09-05/vue2+vite%E5%88%9D%E4%BD%93%E9%AA%8C/"><link rel="next" title="Vue+Antd搭配百度地图实现搜索定位等功能" href="https://gatings.cn/2020-11-03/Vue+Antd%E6%90%AD%E9%85%8D%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E5%AE%9E%E7%8E%B0%E6%90%9C%E7%B4%A2%E5%AE%9A%E4%BD%8D%E7%AD%89%E5%8A%9F%E8%83%BD/"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?914d8fcbdf614fcc92017b47706d7bee";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},translate:{defaultEncoding:2,translateDelay:0,cookieDomain:"https://gatings.cn/",msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简"},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},bookmark:{title:"Snackbar.bookmark.title",message_prev:"按",message_next:"键将本页加入书签"},runtime_unit:"天",runtime:!0,copyright:void 0,ClickShowText:void 0,medium_zoom:!0,fancybox:!0,Snackbar:{bookmark:{title:"Snackbar.bookmark.title",message_prev:"按",message_next:"键将本页加入书签"},chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#2d3035",position:"bottom-left"},baiduPush:!0,isHome:!1,isPost:!0}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="磨蹭先生" type="application/atom+xml">
</head><body><header><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">磨蹭先生</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">39</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">19</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#前言"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">前言</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#初步体验"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">初步体验</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Node10-尝试（可选）"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Node10 尝试（可选）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#开始搭建"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">开始搭建</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#安装-vue-cli-plugin-vite"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">安装 vue-cli-plugin-vite</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#忽略-vue-拓展名"><span class="toc_mobile_items-number">4.1.1.</span> <span class="toc_mobile_items-text">忽略 .vue 拓展名</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#JSX-语法处理"><span class="toc_mobile_items-number">4.1.2.</span> <span class="toc_mobile_items-text">JSX 语法处理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#require-语法处理"><span class="toc_mobile_items-number">4.1.3.</span> <span class="toc_mobile_items-text">require 语法处理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#scss-变量注入"><span class="toc_mobile_items-number">4.1.4.</span> <span class="toc_mobile_items-text">scss 变量注入</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#script-指定环境"><span class="toc_mobile_items-number">4.1.5.</span> <span class="toc_mobile_items-text">script 指定环境</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#额外知识点-keep-alive-使用动态-key-时，热更新无效"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">额外知识点 - keep-alive 使用动态 key 时，热更新无效</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#未解决的问题"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">未解决的问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#总结"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">总结</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#最后"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">最后</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#初步体验"><span class="toc-number">2.</span> <span class="toc-text">初步体验</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Node10-尝试（可选）"><span class="toc-number">3.</span> <span class="toc-text">Node10 尝试（可选）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#开始搭建"><span class="toc-number">4.</span> <span class="toc-text">开始搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-vue-cli-plugin-vite"><span class="toc-number">4.1.</span> <span class="toc-text">安装 vue-cli-plugin-vite</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#忽略-vue-拓展名"><span class="toc-number">4.1.1.</span> <span class="toc-text">忽略 .vue 拓展名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSX-语法处理"><span class="toc-number">4.1.2.</span> <span class="toc-text">JSX 语法处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#require-语法处理"><span class="toc-number">4.1.3.</span> <span class="toc-text">require 语法处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scss-变量注入"><span class="toc-number">4.1.4.</span> <span class="toc-text">scss 变量注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#script-指定环境"><span class="toc-number">4.1.5.</span> <span class="toc-text">script 指定环境</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#额外知识点-keep-alive-使用动态-key-时，热更新无效"><span class="toc-number">5.</span> <span class="toc-text">额外知识点 - keep-alive 使用动态 key 时，热更新无效</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#未解决的问题"><span class="toc-number">6.</span> <span class="toc-text">未解决的问题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">7.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#最后"><span class="toc-number">8.</span> <span class="toc-text">最后</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image:url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">vue2+vite初体验</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2021-09-05<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2021-10-13</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%B0%8F%E5%B7%A5%E5%85%B7/">小工具</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.9k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 16 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>自从 <a href="https://cn.vitejs.dev/" target="_blank" rel="noopener">vite</a> 发布之后，社区赞誉无数，而我也一直心水 <a href="https://cn.vitejs.dev/" target="_blank" rel="noopener">vite</a> 的轻量快速的热重载的特性，特别是公司的项目巨大，已经严重拖慢了热重载的速度了，每次热重载都要等上一小会，所以急需寻找一个解决方案。也发现自己很久没更新博客了，顺手更新一篇下 😢</p><p>虽然，我们通过 <a href="https://www.webpackjs.com/" target="_blank" rel="noopener">webpack</a> 配置，指定了在本地加载的路由，使得热更新更加迅速一些，但是仍然是远远不够的。所以就想着使用 <a href="https://cn.vitejs.dev/" target="_blank" rel="noopener">vite</a> 进行尝试了。</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">dir</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> path.join(__dirname, dir);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> isLocal = process.env.LOCAL === <span class="string">"true"</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  chainWebpack: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isLocal &amp;&amp; fs.existsSync(resolve(<span class="string">"/src/mainDev.js"</span>))) &#123;</span><br><span class="line">      config.entry(<span class="string">"app"</span>).clear().add(<span class="string">"./src/mainDev.js"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><blockquote><p>ps: 我的理想的方案是：<code>webpack</code> 仍然作为打包工具，<code>vite</code> 作为开发工具。因为我仍然觉得 <code>webpack</code> 还是当下构建 <code>webapp</code> 的最佳实践(带有代码拆分，旧浏览器的 Legecy-build)。所以，我会尽量在 <code>vite</code> 和 <code>webpack</code> 环境下维护一份配置。</p></blockquote><blockquote><p>ps: 为了更加无缝的迁移 Vite，这里使用了 vue-cli 插件，即 vue-cli-plugin-vite</p></blockquote><p>本次教程可能过于啰嗦，可以先到<a href="https://gitee.com/gating/demo/tree/master/vite" target="_blank" rel="noopener">gitee</a>、<a href="https://github.com/GATING/demo/tree/master/vite" target="_blank" rel="noopener">github</a>下载体验，也可到文末直接下载代码先自行体验。。。</p><blockquote><p>特别说明：项目使用的 Node 版本为 14.17.6，Node10 项目的版本为 10.15.3，皆为 Node 稳定版本</p></blockquote><h1 id="初步体验"><a href="#初步体验" class="headerlink" title="初步体验"></a>初步体验</h1><p>有了这个想法，当然就打开官网直接开干呀，打开<a href="https://cn.vitejs.dev/guide/#scaffolding-your-first-vite-project" target="_blank" rel="noopener">搭建第一个 Vite 项目</a>，发现 Vite 需要 <a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js</a> 版本 &gt;= 12.0.0，而我公司用的是 <code>Node10</code> 稳定版。</p><p>哦豁 😢！！看到这里，本以为本次迁移就到此结束了~~。</p><h1 id="Node10-尝试（可选）"><a href="#Node10-尝试（可选）" class="headerlink" title="Node10 尝试（可选）"></a>Node10 尝试（可选）</h1><p>当然，我抱着尝着一试的心态，在 Node10 中运行 Vite，然后出现报错了，具体如下：</p><p><font color="red">Error: Cannot find module ‘worker_threads’</font></p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon01.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="vue2-vite-demo-icon01.jpg" class="fancybox"><img alt="vue2-vite-demo-icon01.jpg" title="vue2-vite-demo-icon01.jpg" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon01.jpg" class="lazyload"></a></p><p>所以我 <code>google</code> 搜索了下 <a href="https://stackoverflow.com/questions/62280966/cannot-find-module-worker-threads-error-in-production" target="_blank" rel="noopener">答案</a>，发现 Node10.5 就支持了 workers，不过 Node12 是自动开启，而 Node10 是需要手动开启，所以这边做了如下修改(伪代码):</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">json</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"vite"</span>: <span class="string">"node --experimental-worker ./bin/vite"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>然后- -，Vite 底层出现了新的报错，因为 Vite 的使用了数组的 flat 方法。</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon02.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="vue2-vite-demo-icon02.jpg" class="fancybox"><img alt="vue2-vite-demo-icon02.jpg" title="vue2-vite-demo-icon02.jpg" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon02.jpg" class="lazyload"></a></p><p>所以我们需要对 Vite 进行 Babel 的编译，所以我们需要安装一下 @babel/node，<code>npm i @babel/node -D</code>，伪代码:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">json</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"vite"</span>: <span class="string">"babel-node --experimental-worker ./bin/vite"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>然后就可以愉快的运行啦</p><blockquote><p>ps: 因为这里使用的是 vue-cli-plugin-vite，他是使用 cross-spawn 执行脚本的，所以这里的 babel-node –experimental-worker 在 scripts 无效，需要在 ./bin/vite 文件里编写，具体参考<a href="https://gitee.com/gating/demo/tree/master/vite/vue2-vite-demo-node10" target="_blank" rel="noopener">这个链接-GITEE</a>、<a href="https://github.com/GATING/demo/tree/master/vite/vue2-vite-demo-node10" target="_blank" rel="noopener">这个链接-GITHUB</a></p></blockquote><h1 id="开始搭建"><a href="#开始搭建" class="headerlink" title="开始搭建"></a>开始搭建</h1><p>为了大家尽可能的少改 <code>webpack</code>，我的案例中也覆盖了相对多的常用配置，比如：</p><ul><li>scss 变量注入</li><li>环境变量的使用</li><li>使用别名 alias</li><li>配置 resolve externals</li><li>使用 jsx</li><li>require 语法</li><li>devServer</li><li>require.context 语法兼容</li></ul><blockquote><p>ps: 兼容这些虽然多数都是 vue-cli-plugin-vite 做的事，但是就是想着大家可以拿来即用 😂，更多兼容参考<a href="https://github.com/IndexXuan/vue-cli-plugin-vite" target="_blank" rel="noopener">vue-cli-plugin-vite</a></p></blockquote><p>为了更好的编写体验，这里提供一个基础的 <code>vue-cli</code> 的<a href="https://gitee.com/gating/demo/tree/master/vite/vue2-vite-demo-template" target="_blank" rel="noopener">demo</a>，可以 download 下来一起尝试编写一下。</p><h2 id="安装-vue-cli-plugin-vite"><a href="#安装-vue-cli-plugin-vite" class="headerlink" title="安装 vue-cli-plugin-vite"></a>安装 vue-cli-plugin-vite</h2><p>在当前项目打开终端，运行：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vue add vite</span><br></pre></td></tr></table></figure></div><h3 id="忽略-vue-拓展名"><a href="#忽略-vue-拓展名" class="headerlink" title="忽略 .vue 拓展名"></a>忽略 .vue 拓展名</h3><p>这里后你会发现项目里多了 <code>bin/vite</code> 文件，<code>package.json</code> 的 <code>scripts</code> 也多少了一个 <code>vite</code> 的命令，运行:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm run vite</span><br></pre></td></tr></table></figure></div><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon03.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="vue2-vite-demo-icon03.jpg" class="fancybox"><img alt="vue2-vite-demo-icon03.jpg" title="vue2-vite-demo-icon03.jpg" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon03.jpg" class="lazyload"></a></p><p><code>Unrestricted file system access to &quot;/src/layout&quot;</code>，这个报错说明找不到这个文件，可是我们看，我们明明有<code>layout/index.vue</code>，但是却报找不到，这是为什么呢？这是因为 Vite 的 resolve.extensions 默认的 .vue 的后缀名，官方也不推荐自定义导入类型的扩展名,因为它会影响 IDE 和类型支持。(<a href="https://cn.vitejs.dev/config/#resolve-extensions" target="_blank" rel="noopener">查看链接</a>)</p><p>当然，我们为了兼容以前的旧项目，还是需要配置的，所以我们需要更新下我们的配置，在<code>vue.config.js</code>中补上 resolve.extensions 的配置，代码如下：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      extensions: [<span class="string">".mjs"</span>, <span class="string">".js"</span>, <span class="string">".ts"</span>, <span class="string">".jsx"</span>, <span class="string">".tsx"</span>, <span class="string">".json"</span>, <span class="string">".vue"</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><blockquote><p>ps: 小插曲，之前测试的时候发现配了 resolve.extensions 也没有效果，然后翻阅 Vite 文档，发现 Vite 是支持的，但是 vue-cli-plugin-vite 不支持，所以我给作者提了个 <a href="https://github.com/IndexXuan/vue-cli-plugin-vite/issues/45" target="_blank" rel="noopener">Issue</a>，现在也支持了，感谢作者~~</p></blockquote><blockquote><p>ps: 以后一定要写后缀名<del>~</del> 相关 Issues <a href="https://github.com/vitejs/vite/issues/178#issuecomment-630138450" target="_blank" rel="noopener">178</a>、<a href="https://github.com/vitejs/vite/issues/2163" target="_blank" rel="noopener">2163</a>、</p></blockquote><h3 id="JSX-语法处理"><a href="#JSX-语法处理" class="headerlink" title="JSX 语法处理"></a>JSX 语法处理</h3><p>添加完后，再次运行:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm run vite</span><br></pre></td></tr></table></figure></div><p>发现又报了如下错误：</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon04.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="vue2-vite-demo-icon04.jpg" class="fancybox"><img alt="vue2-vite-demo-icon04.jpg" title="vue2-vite-demo-icon04.jpg" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon04.jpg" class="lazyload"></a></p><p>翻译来说就是说你在 .vue 文件中用了无效的 js 语法(即 JSX)，这里就就需要我们在 vue 的 sfc 组件中还得加上 jsx 标识，即(<code>src/components/HelloWorld.vue</code>)：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">html</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">"jsx"</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Test <span class="keyword">from</span> <span class="string">"./Test"</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    name: <span class="string">"HelloWorld"</span>,</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      Test,</span><br><span class="line">      TestJsx: &#123;</span><br><span class="line">        render() &#123;</span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>我是vue文件的JSX渲染的<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    props: &#123;</span><br><span class="line"><span class="javascript">      msg: <span class="built_in">String</span>,</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>修改完后再次运行，发现又报错了，而且这个错误和上面的还很类似。不过只是说我们在 .js 文件中用了无效的 js 语法(即 JSX)，如果您使用的是 JSX 请确保将文件命名为.JSX 或.tsx 扩展名。</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon05.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="vue2-vite-demo-icon05.jpg" class="fancybox"><img alt="vue2-vite-demo-icon05.jpg" title="vue2-vite-demo-icon05.jpg" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon05.jpg" class="lazyload"></a></p><p>js 中不支持 jsx 的原因，尤大也在 issue 有过说明，具体参考<a href="https://github.com/vitejs/vite/issues/769#issuecomment-780593283" target="_blank" rel="noopener">这个链接</a></p><p>所以，我们只需要把 .js 文件的后缀名修改为 .jsx 即可</p><p>修改完后，再次运行:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm run vite</span><br></pre></td></tr></table></figure></div><p>这里会发现，浏览器报 require is not defined，这里我们先把 Home.vue 文件的 require 注释掉先(require 的问题下面会讲到)，代码如下：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">html</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// @ is an alias to /src</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> HelloWorld <span class="keyword">from</span> <span class="string">"@comp/HelloWorld"</span>;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// const &#123; sum &#125; = require('../utils/index')</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    name: <span class="string">"Home"</span>,</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      HelloWorld,</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      handleClick() &#123;</span><br><span class="line"><span class="actionscript">        <span class="comment">// console.log(sum(1, 32))</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>出现如下报错：</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon06.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="vue2-vite-demo-icon06.jpg" class="fancybox"><img alt="vue2-vite-demo-icon06.jpg" title="vue2-vite-demo-icon06.jpg" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon06.jpg" class="lazyload"></a></p><p>因为我们虽然设置了一堆使用 jsx 的配置，但是没有在插件上配置开启 jsx(即不设置 vitePluginVue2Options: { jsx: true })，所以需要在 vue.config.js 编写下 vite 的配置啦(终于开始配置 vite 了)，<a href="https://github.com/IndexXuan/vue-cli-plugin-vite/issues/9" target="_blank" rel="noopener">相关 issue</a></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  pluginOptions: &#123;</span><br><span class="line">    vite: &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * Plugin[]</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@default </span>[]</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      plugins: [], <span class="comment">// other vite plugins list, will be merge into this plugin\'s underlying vite.config.ts</span></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * Vite UserConfig.optimizeDeps options</span></span><br><span class="line"><span class="comment">       * recommended set `include` for speedup page-loaded time, e.g. include: ['vue', 'vue-router', '<span class="doctag">@scope</span>/xxx']</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@default <span class="type">&#123;&#125;</span></span></span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      optimizeDeps: &#123;&#125;,</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * type-checker, recommended disabled for large-scale old project.</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@default <span class="variable">false</span></span></span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      disabledTypeChecker: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * lint code by eslint</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@default <span class="variable">false</span></span></span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      disabledLint: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * enable css-loader url resolve compat</span></span><br><span class="line"><span class="comment">       * disabled it if you do not use `~@/assets/logo.png` for better performance.</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@default <span class="variable">true</span></span></span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      cssLoaderCompat: <span class="literal">true</span>,</span><br><span class="line">      vitePluginVue2Options: &#123;</span><br><span class="line">        jsx: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><p>再次运行，发现可以打开页面了</p><blockquote><p>总结：在 vite 中使用 jsx 还是稍微有点麻烦的，一是使用到 jsx 语法的 js 文件都必须改成使用 jsx 后缀名，二是在 vue 的 sfc 组件中还得加上 jsx 标识(仅仅引入一个 .jsx 文件 不需要加上)</p></blockquote><h3 id="require-语法处理"><a href="#require-语法处理" class="headerlink" title="require 语法处理"></a>require 语法处理</h3><p>把 require 的注释打开，再次运行，f12 打开控制台，出现如下错误：</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon07.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="vue2-vite-demo-icon07.jpg" class="fancybox"><img alt="vue2-vite-demo-icon07.jpg" title="vue2-vite-demo-icon07.jpg" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon07.jpg" class="lazyload"></a></p><p>因为 vite 不支持 require 的，那么怎么解决呢？这时候就需要使用 vite 插件了。</p><p>这里说说我是怎么找这些插件的吧，通常不知道怎么办的时候，就去 npm 搜索一下关键字 vite commonjs，然后看下这些插件的下载量，率先选择最高的那个使用，这里发现 <a href="https://www.npmjs.com/package/@originjs/vite-plugin-commonjs" target="_blank" rel="noopener">@originjs/vite-plugin-commonjs</a> 这个周下载量有 2000+。所以这里就尝试使用这个了，发现一试还真成了。</p><p>所以，接下来就跟着我一起安装并且配置一下吧。</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install @originjs/vite-plugin-commonjs -D</span><br></pre></td></tr></table></figure></div><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; viteCommonjs &#125; = <span class="built_in">require</span>(<span class="string">"@originjs/vite-plugin-commonjs"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  pluginOptions: &#123;</span><br><span class="line">    vite: &#123;</span><br><span class="line">      plugins: [</span><br><span class="line">        viteCommonjs(&#123;</span><br><span class="line">          <span class="comment">// lodash不需要进行转换</span></span><br><span class="line">          exclude: [<span class="string">"lodash"</span>],</span><br><span class="line">        &#125;),</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><blockquote><p>ps: 但是标签上的 require 并不支持，所以建议全面拥抱 ES Module</p></blockquote><blockquote><p>ps: 路由使用 <code>resolve =&gt; require([&#39;../components/views/Home.vue&#39;], resolve)</code> 导入的，可以通过 vscode 使用下面的正则全局替换<br><br>搜索：<code>\(?resolve\)?\s*=&gt;\s*require\(\[(.\*)\], resolve\)</code><br><br>替换：<code>() =&gt; import($1)</code></p></blockquote><h3 id="scss-变量注入"><a href="#scss-变量注入" class="headerlink" title="scss 变量注入"></a>scss 变量注入</h3><p>重新运行一下，发现啥问题都没有，看着一切正常，这时候我觉得 HelloWorld 组件缺点样式，我想美化一样，比如修改下字体颜色、文字大小啥的。</p><p>所以我对 HelloWorld 组件添加了样式，进行了如下修改：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">html</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h1"</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">test</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">test-jsx</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">"jsx"</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Test <span class="keyword">from</span> <span class="string">"./Test"</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    name: <span class="string">"HelloWorld"</span>,</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      Test,</span><br><span class="line">      TestJsx: &#123;</span><br><span class="line">        render() &#123;</span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>我是vue文件的JSX渲染的<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    props: &#123;</span><br><span class="line"><span class="javascript">      msg: <span class="built_in">String</span>,</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"scss"</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.h1</span> &#123;</span></span><br><span class="line">    font-size: 30px;</span><br><span class="line">    color: skyblue;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.hello</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="keyword">@include</span> bgCover(<span class="string">"@/assets/logo.png"</span>);</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>还没开始写呢，控制台就一堆报错：</p><p><a href="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon08.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="vue2-vite-demo-icon08.jpg" class="fancybox"><img alt="vue2-vite-demo-icon08.jpg" title="vue2-vite-demo-icon08.jpg" data-src="https://cdn.JsDelivr.net/gh/GATING/blog_imgs/2021-09-05/vue2-vite-demo-icon08.jpg" class="lazyload"></a></p><p>猜测是使用了别名导入 scss 后，识别到 url() 后就会输出相对路径，所以这边在 vite 环境时候，使用 src/styles 导入即可，具体 vue.config.js 修改如下：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// npm 正在执行哪个 script,npm_lifecycle_event 就返回当前正在运行的脚本名称。</span></span><br><span class="line"><span class="keyword">const</span> isVite = process.env.npm_lifecycle_event.startsWith(<span class="string">"vite"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 兼容vite</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAdditionalData</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isVite) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/@style\//</span>, <span class="string">"src/styles/"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  css: &#123;</span><br><span class="line">    requireModuleExtension: <span class="literal">true</span>,</span><br><span class="line">    loaderOptions: &#123;</span><br><span class="line">      scss: &#123;</span><br><span class="line">        <span class="comment">// 注意：在 sass-loader v7 中，这个选项名是 "data" 官网文档还是prependData   此项目用的7+版本</span></span><br><span class="line">        <span class="comment">// 注意：在 sass-loader v10 使用 additionalData，这里为了兼容vite，所以升级了sass-loader@10</span></span><br><span class="line">        additionalData: getAdditionalData(<span class="string">`@import '@style/variables.scss';`</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><blockquote><p>ps: 这里也有个小知识点，我们可以通过 npm_lifecycle_event 来获取我们执行了的脚本名称，通过 npm_lifecycle_script 获取执行了什么命令</p></blockquote><h3 id="script-指定环境"><a href="#script-指定环境" class="headerlink" title="script 指定环境"></a>script 指定环境</h3><p>通常我们会有 beta、pre、dev 好几个环境，在 vue-cli 开发的时候我们通过会通过 <code>--mode env</code> 指定我们本地的开发环境，现在我们也尝试在 scripts 中的 vite 指定 staging 环境，发现并没有效果：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">json</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"vite"</span>: <span class="string">"node ./bin/vite --mode staging"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>这是为什么呢？打开 bin/vite 文件一看，发现 使用 cross-spawn 执行脚本的，所以 <code>--mode staging</code> 这个参数根本就没有获取，那么我们怎么可以获取呢？</p><p>其实我们可以通过 process.argv 获取我们执行的命令的参数，打印一下发现 argv 是个数组，而我们需要的是最后那两个，所以这里需要进行如下修改(<code>bin/vite</code>)：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> spawn = <span class="built_in">require</span>(<span class="string">"cross-spawn"</span>);</span><br><span class="line"><span class="keyword">const</span> configPath = <span class="built_in">require</span>.resolve(<span class="string">"vue-cli-plugin-vite/config/index.ts"</span>);</span><br><span class="line"><span class="keyword">const</span> cwd = path.resolve(__dirname, <span class="string">"../"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = [</span><br><span class="line">  <span class="string">`<span class="subst">$&#123;process.env.BUILD ? <span class="string">"build"</span> : <span class="string">""</span>&#125;</span>`</span>,</span><br><span class="line">  process.env.VITE_DEBUG ? <span class="string">"--debug"</span> : <span class="string">""</span>,</span><br><span class="line">  <span class="string">"--config"</span>,</span><br><span class="line">  <span class="string">`<span class="subst">$&#123;configPath&#125;</span>`</span>,</span><br><span class="line">  ...process.argv.slice(<span class="number">2</span>),</span><br><span class="line">].filter(<span class="built_in">Boolean</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`running: vite <span class="subst">$&#123;params.join(<span class="string">" "</span>)&#125;</span>`</span>);</span><br><span class="line"><span class="keyword">const</span> serveService = spawn(<span class="string">"vite"</span>, params, &#123;</span><br><span class="line">  cwd,</span><br><span class="line">  stdio: <span class="string">"inherit"</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">serveService.on(<span class="string">"close"</span>, (code) =&gt; &#123;</span><br><span class="line">  process.exit(code);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><p>至此，我们的 vite 命令也可以指定开发环境啦 😉</p><h1 id="额外知识点-keep-alive-使用动态-key-时，热更新无效"><a href="#额外知识点-keep-alive-使用动态-key-时，热更新无效" class="headerlink" title="额外知识点 - keep-alive 使用动态 key 时，热更新无效"></a>额外知识点 - keep-alive 使用动态 key 时，热更新无效</h1><p>一般的后台管理肯定需要 keep-alive 这个组件，比如我们 layout 组件上就是用了 keep-alive，但是你会发现在你使用 keep-alive 的时候，页面却没有热更新，这个不是 vite 的问题，也不是 webpack 的问题，这是 Vue 的问题(当然也有<a href="https://github.com/vuejs/vue/pull/12092" target="_blank" rel="noopener">相关 issue</a>)，而且这个 issue 已经从 18 年就开始有了，且现在仍然是 open 状态(<a href="https://github.com/vuejs/vue-loader/issues/1332" target="_blank" rel="noopener">相关 issue</a>)</p><p>参考评论和 issue，我们也可以编写一个只在开发环境中使用的 keep-alive 组件了。</p><p>创建 plugins/keep-alive.js 文件，编写如下代码：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isArray, isRegExp &#125; <span class="keyword">from</span> <span class="string">"lodash"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params">arr, item</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.length) &#123;</span><br><span class="line">    <span class="keyword">var</span> index = arr.indexOf(item);</span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> arr.splice(index, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDef</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> v !== <span class="literal">undefined</span> &amp;&amp; v !== <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAsyncPlaceholder</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> node.isComment &amp;&amp; node.asyncFactory;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFirstComponentChild</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isArray(children)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.length; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> c = children[i];</span><br><span class="line">      <span class="keyword">if</span> (isDef(c) &amp;&amp; (isDef(c.componentOptions) || isAsyncPlaceholder(c))) &#123;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getComponentName</span>(<span class="params">opts</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> opts &amp;&amp; (opts.Ctor.options.name || opts.tag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">matches</span>(<span class="params">pattern</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isArray(pattern)) &#123;</span><br><span class="line">    <span class="keyword">return</span> pattern.indexOf(name) &gt; <span class="number">-1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> pattern === <span class="string">"string"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> pattern.split(<span class="string">","</span>).indexOf(name) &gt; <span class="number">-1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isRegExp(pattern)) &#123;</span><br><span class="line">    <span class="keyword">return</span> pattern.test(name);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* istanbul ignore next */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pruneCache</span>(<span class="params">keepAliveInstance, filter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; cache, keys, _vnode &#125; = keepAliveInstance;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> cache) &#123;</span><br><span class="line">    <span class="keyword">const</span> entry = cache[key];</span><br><span class="line">    <span class="keyword">if</span> (entry) &#123;</span><br><span class="line">      <span class="keyword">const</span> name = entry.name;</span><br><span class="line">      <span class="keyword">if</span> (name &amp;&amp; !filter(name)) &#123;</span><br><span class="line">        pruneCacheEntry(cache, key, keys, _vnode);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pruneCacheEntry</span>(<span class="params">cache, key, keys, current</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> entry = cache[key];</span><br><span class="line">  <span class="keyword">if</span> (entry &amp;&amp; (!current || entry.tag !== current.tag)) &#123;</span><br><span class="line">    entry.componentInstance.$destroy();</span><br><span class="line">  &#125;</span><br><span class="line">  cache[key] = <span class="literal">null</span>;</span><br><span class="line">  remove(keys, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  install(app) &#123;</span><br><span class="line">    <span class="comment">//只在开发模式下生效</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">"development"</span>) &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * Remove an item from an array.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> patternTypes = [<span class="built_in">String</span>, <span class="built_in">RegExp</span>, <span class="built_in">Array</span>];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> KeepAlive = &#123;</span><br><span class="line">        name: <span class="string">"keep-alive"</span>,</span><br><span class="line">        abstract: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        props: &#123;</span><br><span class="line">          include: patternTypes,</span><br><span class="line">          exclude: patternTypes,</span><br><span class="line">          max: [<span class="built_in">String</span>, <span class="built_in">Number</span>],</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        methods: &#123;</span><br><span class="line">          cacheVNode() &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; cache, keys, vnodeToCache, keyToCache &#125; = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">if</span> (vnodeToCache) &#123;</span><br><span class="line">              <span class="keyword">const</span> &#123; tag, componentInstance, componentOptions &#125; = vnodeToCache;</span><br><span class="line">              cache[keyToCache] = &#123;</span><br><span class="line">                name: getComponentName(componentOptions),</span><br><span class="line">                tag,</span><br><span class="line">                componentInstance,</span><br><span class="line">                cid: vnodeToCache.cid,</span><br><span class="line">              &#125;;</span><br><span class="line">              keys.push(keyToCache);</span><br><span class="line">              <span class="comment">// prune oldest entry</span></span><br><span class="line">              <span class="keyword">if</span> (<span class="keyword">this</span>.max &amp;&amp; keys.length &gt; <span class="built_in">parseInt</span>(<span class="keyword">this</span>.max)) &#123;</span><br><span class="line">                pruneCacheEntry(cache, keys[<span class="number">0</span>], keys, <span class="keyword">this</span>._vnode);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">this</span>.vnodeToCache = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        created() &#123;</span><br><span class="line">          <span class="keyword">this</span>.cache = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">          <span class="keyword">this</span>.keys = [];</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        destroyed() &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="keyword">this</span>.cache) &#123;</span><br><span class="line">            pruneCacheEntry(<span class="keyword">this</span>.cache, key, <span class="keyword">this</span>.keys);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        mounted() &#123;</span><br><span class="line">          <span class="keyword">this</span>.cacheVNode();</span><br><span class="line">          <span class="keyword">this</span>.$watch(<span class="string">"include"</span>, (val) =&gt; &#123;</span><br><span class="line">            pruneCache(<span class="keyword">this</span>, (name) =&gt; matches(val, name));</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">this</span>.$watch(<span class="string">"exclude"</span>, (val) =&gt; &#123;</span><br><span class="line">            pruneCache(<span class="keyword">this</span>, (name) =&gt; !matches(val, name));</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        updated() &#123;</span><br><span class="line">          <span class="keyword">this</span>.cacheVNode();</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        render() &#123;</span><br><span class="line">          <span class="keyword">const</span> slot = <span class="keyword">this</span>.$slots.default;</span><br><span class="line">          <span class="keyword">const</span> vnode = getFirstComponentChild(slot);</span><br><span class="line">          <span class="keyword">const</span> componentOptions = vnode &amp;&amp; vnode.componentOptions;</span><br><span class="line">          <span class="keyword">if</span> (componentOptions) &#123;</span><br><span class="line">            vnode.cid = componentOptions.Ctor.cid;</span><br><span class="line">            <span class="comment">// check pattern</span></span><br><span class="line">            <span class="keyword">const</span> name = getComponentName(componentOptions);</span><br><span class="line">            <span class="keyword">const</span> &#123; include, exclude &#125; = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">              <span class="comment">// not included</span></span><br><span class="line">              (include &amp;&amp; (!name || !matches(include, name))) ||</span><br><span class="line">              <span class="comment">// excluded</span></span><br><span class="line">              (exclude &amp;&amp; name &amp;&amp; matches(exclude, name))</span><br><span class="line">            ) &#123;</span><br><span class="line">              <span class="keyword">return</span> vnode;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> &#123; cache, keys &#125; = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">const</span> key =</span><br><span class="line">              vnode.key == <span class="literal">null</span></span><br><span class="line">                ? <span class="comment">// same constructor may get registered as different local components</span></span><br><span class="line">                  <span class="comment">// so cid alone is not enough (#3269)</span></span><br><span class="line">                  componentOptions.Ctor.cid +</span><br><span class="line">                  (componentOptions.tag ? <span class="string">`::<span class="subst">$&#123;componentOptions.tag&#125;</span>`</span> : <span class="string">""</span>)</span><br><span class="line">                : vnode.key;</span><br><span class="line">            <span class="keyword">if</span> (cache[key]) &#123;</span><br><span class="line">              <span class="keyword">if</span> (vnode.cid === cache[key].cid) &#123;</span><br><span class="line">                vnode.componentInstance = cache[key].componentInstance;</span><br><span class="line">                <span class="comment">// make current key freshest</span></span><br><span class="line">                remove(keys, key);</span><br><span class="line">                keys.push(key);</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cache[key].componentInstance.$destroy();</span><br><span class="line">                cache[key] = vnode;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// delay setting the cache until update</span></span><br><span class="line">              <span class="keyword">this</span>.vnodeToCache = vnode;</span><br><span class="line">              <span class="keyword">this</span>.keyToCache = key;</span><br><span class="line">            &#125;</span><br><span class="line">            vnode.data.keepAlive = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> vnode || (slot &amp;&amp; slot[<span class="number">0</span>]);</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      app.component(<span class="string">"keep-alive"</span>, KeepAlive);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><p>在 main.js 引入：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand code-closed" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> KeepAlive <span class="keyword">from</span> <span class="string">"./plugins/keep-alive"</span>;</span><br><span class="line">Vue.use(KeepAlive);</span><br></pre></td></tr></table></figure></div><p>这样子，我们的 keep-alive 就具有热更新功能啦ヾ(≧▽≦*)</p><h1 id="未解决的问题"><a href="#未解决的问题" class="headerlink" title="未解决的问题"></a>未解决的问题</h1><ul><li><p>含有 jsx 标识的 vue 文件热更新失效，.jsx 文件有效，<a href="https://github.com/vitejs/vite/issues/1486" target="_blank" rel="noopener">相关 issue</a></p><ul><li>但是有<a href="https://github.com/vitejs/vite/pull/4563" target="_blank" rel="noopener">相关 pr</a>实现了 jsx in sfc 的热更新，但是我在 vue2 中使用并未热更新</li></ul></li></ul><blockquote><p>ps: vue-cli-plugin-vite 插件中的 vite 是锁定 <a href="mailto:vite@2.5.1">vite@2.5.1</a> 版本的<a href="https://github.com/IndexXuan/vue-cli-plugin-vite/issues/46" target="_blank" rel="noopener">相关 issue</a>，而这个 issue 的 <a href="https://github.com/vitejs/vite/pull/4563" target="_blank" rel="noopener">相关 pr</a> 是 2.5.3 版本才 merge，不过我尝试使用 <a href="mailto:vite@2.5.3">vite@2.5.3</a> 也没有成功</p></blockquote><blockquote><p>ps: 看了下源代码，<a href="https://github.com/vitejs/vite" target="_blank" rel="noopener">github</a>上的源码已经 merge 了，但是 npm 上部分包仍然没有发布，比如<a href="https://www.npmjs.com/package/@vitejs/plugin-vue" target="_blank" rel="noopener">@vitejs/plugin-vue</a>、<a href="https://www.npmjs.com/package/@vitejs/plugin-vue-jsx" target="_blank" rel="noopener">@vitejs/plugin-vue-jsx</a>，猜测下个版本应该就能实现 jsx in sfc 的热更新了 😍。<br>不过我们也可以将 <a href="https://github.com/vitejs/vite/pull/4563" target="_blank" rel="noopener">pr</a> 的源码复制到 node_modules 里也可提前体验 jsx in sfc 的热更新🤞</p></blockquote><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>虽然- -这里没有用实际项目对比，也没有实际的数据对比，但是大家可以 download 那个配置在自己项目体验一下，迁移起来还是比较简单的。如果有什么问题欢迎大家留言进行交流~~</p><p>最后再强调，在 vite 中使用 jsx 语法的话，一是使用到 jsx 语法的 js 文件都必须改成使用 jsx 后缀名，二是在 vue 的 sfc 组件中还得加上 jsx 标识(仅仅引入一个 .jsx 文件 不需要加上)</p><p>仓库代码链接如下：</p><ul><li><p><a href="https://gitee.com/gating/demo/tree/master/vite" target="_blank" rel="noopener">gitee 地址</a></p><ul><li><p><a href="https://gitee.com/gating/demo/tree/master/vite/vue2-vite-demo-template" target="_blank" rel="noopener">vue2-vite-demo-template</a></p></li><li><p><a href="https://gitee.com/gating/demo/tree/master/vite/vue2-vite-demo" target="_blank" rel="noopener">vue2-vite-demo</a></p></li><li><p><a href="https://gitee.com/gating/demo/tree/master/vite/vue2-vite-demo-node10" target="_blank" rel="noopener">vue2-vite-demo-node10</a></p></li></ul></li><li><p><a href="https://github.com/GATING/demo/tree/master/vite" target="_blank" rel="noopener">github 地址</a></p><ul><li><p><a href="https://github.com/GATING/demo/tree/master/vite/vue2-vite-demo-template" target="_blank" rel="noopener">vue2-vite-demo-template</a></p></li><li><p><a href="https://github.com/GATING/demo/tree/master/vite/vue2-vite-demo" target="_blank" rel="noopener">vue2-vite-demo</a></p></li><li><p><a href="https://github.com/GATING/demo/tree/master/vite/vue2-vite-demo-node10" target="_blank" rel="noopener">vue2-vite-demo-node10</a></p></li></ul></li></ul><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>虽然本文罗嗦了点，但还是感谢各位观众老爷的能看到最后 O(∩_∩)O 希望你能有所收获 😁</p></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">gating</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gatings.cn/2021-09-05/vue2+vite%E5%88%9D%E4%BD%93%E9%AA%8C/">https://gatings.cn/2021-09-05/vue2+vite%E5%88%9D%E4%BD%93%E9%AA%8C/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gatings.cn">磨蹭先生</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vite/">vite</a></div><div class="post_share"></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/GATING/blog_imgs@master/blog/alipay.jpg" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2020-11-03/Vue+Antd%E6%90%AD%E9%85%8D%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E5%AE%9E%E7%8E%B0%E6%90%9C%E7%B4%A2%E5%AE%9A%E4%BD%8D%E7%AD%89%E5%8A%9F%E8%83%BD/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror='onerror=null,src="/img/404.jpg"'><div class="label">下一篇</div><div class="next_info"><span>Vue+Antd搭配百度地图实现搜索定位等功能</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTA5MC8xMTYyNQ=="><script>!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script></div></div></div></main><footer id="footer" style="background-image:url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2021 By gating</div><div class="footer_custom_text">由<b>&nbsp;磨蹭&nbsp;</b>倾力打造&nbsp;|&nbsp;<b>女王大人</b>&nbsp;-&nbsp;热情赞助</div><div class="icp"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"><span>粤ICP备17035705号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments"></i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>